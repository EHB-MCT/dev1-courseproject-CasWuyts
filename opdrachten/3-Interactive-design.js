// Portions of this project were developed using suggestions generated by ChatGPT (OpenAI)
// 25/11/2024: https://chatgpt.com/share/676361be-87d8-8009-bbdd-ba7cc7534f4c to an external site.
// Modifications made by Cas WUyts

"use strict";
import context from "../../scripts/context.js";
import * as Utils from "../../scripts/utils.js";

let width = canvas.width;
let height = canvas.height;

let sunY = height;
let sunRadius = Utils.randomNumber(250, 400);
let sunMaxHeight = height / 2;

let buildings = generateBuildings();
let showWindows = false;

canvas.onmousemove = onMouseMove;
canvas.onclick = toggleWindows;

draw();

function draw() {
	context.fillStyle = "#363330";
	context.fillRect(0, 0, width, height);

	drawSun();

	drawBuildings();

	signature();

	requestAnimationFrame(draw);
}

function generateBuildings() {
	let buildings = [];
	for (let i = 0; i < 30; i++) {
		let x = i * (width / 30);
		let buildingWidth = width / 10 - 10;
		let buildingHeight = Utils.randomNumber(100, 400);
		buildings.push({
			x,
			y: height - buildingHeight,
			width: buildingWidth,
			height: buildingHeight,
		});
	}
	return buildings;
}

function drawBuildings() {
	for (let building of buildings) {
		let brightness = calculateBuildingBrightness(sunY);
		brightness = Math.max(10, Math.min(100, brightness));

		context.fillStyle = Utils.hsl(240, 50, brightness);
		context.fillRect(building.x, building.y, building.width, building.height);

		if (showWindows) drawWindows(building);
	}
}

function calculateBuildingBrightness(sunY) {
	let brightness = 10 + ((height - sunY) / (height - sunMaxHeight)) * 30;
	return brightness;
}

function drawWindows(building) {
	let rows = Math.floor(building.height / 20);
	let cols = Math.floor(building.width / 15);

	for (let row = 0; row < rows; row++) {
		for (let col = 0; col < cols; col++) {
			let x = building.x + col * 15 + 5;
			let y = building.y + row * 20 + 5;

			// Draw the windows as yellow
			context.fillStyle = "yellow";
			context.fillRect(x, y, 10, 10);
		}
	}
}

function drawSun() {
	context.fillStyle = "orange";
	Utils.fillEllipse(width / 2, sunY, sunRadius, sunRadius);
}

function onMouseMove(event) {
	let mouseY = event.clientY;
	sunY = mouseY;
}

function toggleWindows() {
	showWindows = !showWindows;
}

function signature() {
	context.fillStyle = "#F0F0F0";
	context.fillRect(width - 75, height - 75, 75, 75);
	context.fillStyle = "#0EFFF8";
	context.fillRect(width - 68.75, height - 68.75, 12.5, 12.5);
	context.fillRect(width - 20.75, height - 68.75, 12.5, 12.5);
	context.fillRect(width - 68.75, height - 31.25, 62.5, 12.5);
	context.fillRect(width - 56.25, height - 43.75, 12.5, 12.5);
	context.fillRect(width - 31.25, height - 43.75, 12.5, 12.5);
}
